<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<div th:insert="~{top:: top}"></div>
<head>
</head>
<script>
  $(document).ready(function(){
      $("#checkId").on("click", function(){
          let username = $("#username").val();

          if (username === "") {
              $("#idCheckMessage").text("아이디를 입력해주세요.").css("color", "red");
              return;
          }

          $.ajax({
              url: "/checkId", // 서버의 URL
              type: "POST",    // POST 방식으로 전송
              data: { username: username }, // 서버에 보낼 데이터
              success: function(response){
                  // 서버로부터 응답을 받았을 때 실행되는 함수
                  if (response === "available") {
                      $("#idCheckMessage").text("사용 가능한 아이디입니다.").css("color", "green");
                  } else {
                      $("#idCheckMessage").text("이미 사용 중인 아이디입니다.").css("color", "red");
                  }
              },
              error: function(){
                  // 통신 실패 시
                  alert("서버 통신 오류가 발생했습니다.");
              }
          });
      });
  });

$(document).ready(function(){
  $("#checkNickname").on("click",function(){
    let nickname = $("#nickname").val();

    if(nickname == ""){
       $("#nicknameCheckMessage").text("닉네임을 입력해주세요.").css("color", "red");
              return;
    }

    $.ajax({
      url:"/checkNickname",
      type: "post",
      data : {nickname,nickname},
      success : function(response){
        if(response==="available"){
          $("#nicknameCheckMessage").text("사용 가능한 닉네임입니다.").css("color", "green");
        }
        else{
           $("#nicknameCheckMessage").text("이미 사용 중인 닉네임입니다.").css("color", "red");
        }
      },
      error: function(){
         alert("서버 통신 오류가 발생했습니다.");
      }
    });
  });
});

$(document).ready(function(){
  $("#checkEmail").on("click",function(){
    let email = $("#email").val();

    if(email == ""){
       $("#emailCheckMessage").text("이메일을 입력해주세요.").css("color", "red");
              return;
    }

    $.ajax({
      url:"/checkEmail",
      type: "post",
      data : {email,email},
      success : function(response){
        if(response==="available"){
          $("#emailCheckMessage").text("사용 가능한 이메일입니다.").css("color", "green");
        }
        else{
           $("#emailCheckMessage").text("사용중인 이메일입니다.").css("color", "red");
        }
      },
      error: function(){
         alert("서버 통신 오류가 발생했습니다.");
      }
    });
  });
});

function validatePassword(){
  let password =$("#password").val();
  let checkPw = $("#checkPw").val();
  const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{8,16}$/;

  if(!passwordRegex.test(password)){
    $("#pwCheckMessage").text("비밀번호는 영문,숫자,특수문자를 포함하여 8~16자로 입력해주세요").css("color","red");
    return false;
  }
  if(password != checkPw){
    $("#pwCheckMessage").text("비밀번호가 일치하지 않습니다.").css("color","red");
    return false;
  }
  else{
    $("#pwCheckMessage").text("비밀번호가 일치합니다.").css("color","green");
    return true;
  }
}

function validationEmail(){
  let email = $("#email").val();
  const emailRegex = /^[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$/;

  if(email ==""){
    $("#emailCheckMessage").text("");
    return false;
  }

  if(!emailRegex.test(email)){
    $("#emailCheckMessage").text("이메일 형식에 맞지 않습니다.").css("color","red");
    return false;
  }
  $("#emailCheckMessage").text("이메일 형식과 일치합니다.").css("color","green");
  return true;
}
</script>
<body>
<div class="main-container">
  <div class="foam-container">
    <form th:action="@{/memberSave}" method="post">
      <div class="id-group">
        <label for="username">아이디</label>
        <input type="text" name="username" id="username" placeholder="아이디를 입력해주세요" required>
        <button type="button" id="checkId" >중복확인</button>
        <p id="idCheckMessage" class="message"></p>
      </div>
      <div class="pw-group">
        <label for="password">비밀번호</label>
        <input type="password" id="password" name="password" placeholder="비밀번호를 입력해주세요" required
               onkeyup="validatePassword()">
        <label for="checkPw">비밀번호 확인</label>
        <input type="password" id="checkPw" name="checkPw" placeholder="비밀번호 확인" required
               onkeyup="validatePassword()">
        <p id="pwCheckMessage" class="message"></p>
      </div>
      <div class="name-group">
        <label for="realname">이름</label>
        <input type="text" id="realname" name="realname" placeholder="이름을 입력해주세요">
      </div>
      <div class="nickname-group">
        <label for="nickname">닉네임</label>
        <input type="text" id="nickname" name="nickname" placeholder="닉네임을 입력해주세요" required>
        <button type="button" id="checkNickname">중복확인</button>
        <p id="nicknameCheckMessage" class="message"></p>
      </div>
      <div>
        <label for="email">이메일</label>
        <input type="email" id="email" name="email" required placeholder="example@exam.com" onkeyup="validationEmail()">
        <button type="button" id="checkEmail">중복확인</button>
        <p id="emailCheckMessage" class="message"></p>
      </div>
      <div class="birth-group">
        <label for="birth">생년월일</label>
        <input type="date" id="birth" name="birth" required>
      </div>
      <div class="button-group">
        <button type="submit">회원가입</button>
      </div>
      <div>
        <input type="hidden" name="role" value="role_user">
      </div>
    </form>
  </div>
</div>
</body>

</html>